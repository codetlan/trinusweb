/*
Copyright(c) 2012 Codetlan
*/
Ext.Loader.setConfig({enabled:true});Ext.application({name:"Trinus",requires:["App.view.login.FormPanel","App.view.principal.Panel","App.view.admin.Panel"],defaults:{},launch:function(){if(!localStorage.getItem("Logeado")){this.window=Ext.create("Ext.window.Window",{title:"Bienvenido!!!",width:310,height:220,layout:"fit",closable:false,draggable:false,items:[{xtype:"formpanellogin",listeners:{scope:this,logeado:this.iniciar}}]}).show()}else{this.iniciar()}},iniciar:function(){if(this.window){this.window.destroy()}var c=Ext.decode(localStorage.getItem("Usuario")),b="",a=false;switch(c.tipo){case"0":b="panelprincipaladmin";break;case"1":b="panelprincipal";break;case"3":b="panelprincipaladmin";a=true;break}Ext.create("Ext.container.Viewport",{layout:"fit",items:[{xtype:b,esSitio:a}]})}});Ext.define("App.view.login.FormPanel",{extend:"Ext.form.Panel",alias:"widget.formpanellogin",requires:["App.view.registro.FormPanel"],bodyPadding:10,buttonAlign:"center",defaults:{xtype:"textfield",margin:5,allowBlank:false,labelWidth:110,style:{fontFamily:"orbitron-medium"}},initComponent:function(){this.items=this.buildItems();this.buttons=this.buidlButtons();this.callParent(arguments)},buildItems:function(){var a=[{fieldLabel:"Movil",name:"txtMovil",value:"5555555555"},{fieldLabel:"Password",inputType:"password",name:"txtPass",value:"trinus",listeners:{scope:this,specialkey:function(c,b){if(b.getKey()==b.ENTER){this.logeo()}}}}];return a},buidlButtons:function(){var a=[{text:"Registrate",ui:"inverse",scale:"medium",iconCls:"icon-user icon-white",scope:this,handler:this.windowRegistrarse},{scope:this,text:"Ingresa",ui:"warning",scale:"medium",iconCls:"icon-ok icon-white",handler:this.logeo}];return a},logeo:function(){var b=this.getForm(),d=b.getValues();if(b.isValid()){var c=new XMLHttpRequest(),a="http://isystems.com.mx:8181/Trinus/ServletLogin?movil="+d.txtMovil+"&password="+d.txtPass;if(c){c.open("POST",a,true);c.onreadystatechange=this.logear.bind(this);c.send()}}},logear:function(a){if(a.target.readyState==4&&a.target.status==200){var b=Ext.decode(a.target.responseText);if(b.result==="ok"){localStorage.setItem("Logeado",b.token);localStorage.setItem("Usuario",Ext.encode(b));this.fireEvent("logeado",b)}else{Ext.MessageBox.alert("Status",b.result)}}},windowRegistrarse:function(){this.fireEvent("mask");this.window=Ext.create("Ext.window.Window",{title:"Ingresa tus Datos",width:415,height:336,draggable:false,layout:"fit",items:[{xtype:"formregistrarse",listeners:{scope:this,cerrarWindow:function(){this.window.close()}}}]}).show()}});Ext.define("App.view.principal.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelprincipal",requires:["Ext.toolbar.Toolbar","App.view.menu.MenuPanel","App.view.xtemplate.XtemplateTaxista","App.view.recarga.FormPanel"],layout:"border",initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){this.tplTaxista=Ext.create("App.view.xtemplate.XtemplateTaxista",{data:{nombre:""}});var a=[{xtype:"panel",region:"east",bbar:this.buildBbar(),flex:2,layout:{type:"vbox",align:"stretch",pack:"start"},items:[{flex:7,xtype:"menupanel",layout:{type:"vbox",align:"stretch",pack:"start"},listeners:{scope:this,pedirtaxi:this.pedirTaxi}},{flex:4,xtype:"container",items:[this.tplTaxista]}]},{xtype:"container",region:"center",flex:5,html:'<div id="map_canvas" style="height: 100%; width: 100%;"></div>',listeners:{scope:this,afterrender:function(){this.setPosicionActual(this.createMap.bind(this))}}}];return a},buildBbar:function(){var b=this,a=Ext.create("Ext.toolbar.Toolbar",{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Posición",flex:1,ui:"inverse",iconCls:"icon-map-marker icon-white",scale:"medium",handler:function(){b.setPosicionActual(b.actualizaPosicionCliente.bind(b))}},{xtype:"button",text:"Recarga",flex:1,ui:"warning",iconCls:"icon-shopping-cart icon-white",scale:"medium",scope:this,handler:b.recargaSaldo},{xtype:"button",text:"Salir",flex:1,ui:"inverse",iconCls:"icon-off icon-white",scale:"medium",handler:b.salir}]});return a},salir:function(){localStorage.removeItem("Logeado");localStorage.removeItem("Usuario");location.href="index.html"},setPosicionActual:function(a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a,this.gestionaErroresGeo)}else{alert("Tu navegador no soporta la API de geolocalizacion")}},createMap:function(a){console.log("actual position: ");console.log(a);var d=this,b={zoom:14,center:new google.maps.LatLng(a.coords.latitude,a.coords.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP},c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);this.infowindow=new google.maps.InfoWindow();this.map=new google.maps.Map(document.getElementById("map_canvas"),b);this.markerCliente=this.addMarker({draggable:true,position:c,map:this.map,animation:google.maps.Animation.DROP,listeners:{dragend:function(){d.setAddressMarker(d.map,d.markerCliente,d.infowindow,d.markerCliente.getPosition())},click:function(){d.infowindow.open(d.map,d.markerCliente)}}});this.setAddressMarker(this.map,d.markerCliente,d.infowindow,c);this.autoCompleteOnDestino(a)},setAddressMarker:function(e,a,c,g,b){var f=this,d=new google.maps.Geocoder();d.geocode({latLng:g},function(k,j){if(j==google.maps.GeocoderStatus.OK){if(k[0]){var h=k[0].formatted_address;e.setZoom(16);c.setContent(h);c.setOptions({maxWidth:150});c.open(e,a);if(!b){f.setAddressText(h)}}}})},gestionaErroresGeo:function(a){if(a.code==0){alert("error desconocido")}if(a.code==1){alert("El usuario no ha compartido su posicion")}if(a.code==2){alert("no se puede obtener la posicion actual")}if(a.code==3){alert("timeout recibiendo la posicion")}},pedirTaxi:function(d){var f=this,c=new XMLHttpRequest(),a=f.markerCliente.getPosition(),e="idCliente="+Ext.decode(localStorage.getItem("Usuario")).idCliente+"&direccion="+d.txtOrigen+"&latitud="+a.lat()+"&longitud="+a.lng()+"&observ="+d.txtObservaciones+"&token="+localStorage.getItem("Logeado"),b="http://isystems.com.mx:8181/Trinus/ServletServicioMovil?"+e;if(c){c.open("POST",b,true);c.onreadystatechange=function(g){if(g.target.readyState==4&&g.target.status==200){var h=Ext.decode(g.target.responseText);if(h.result==="ok"){Ext.MessageBox.alert("Información","La petición se ha procesado con éxito.",f.pedirDatosTaxi.bind(f,h.idServicio))}else{Ext.MessageBox.alert("Información",h.result)}}};c.send()}},pedirDatosTaxi:function(a){var e=this,c=new XMLHttpRequest(),d="idServicio="+a+"&estatus=ACEPTADO&token="+localStorage.getItem("Logeado"),b="http://isystems.com.mx:8181/Trinus/DatosTaxista?"+d;e.items.items[1].el.mask("Buscando al taxista mas cercano, por favor espere...");if(c){c.open("POST",b,true);c.onreadystatechange=function(f){if(f.target.readyState==4&&f.target.status==200){var g=Ext.decode(f.target.responseText);if(g.result==="ok"){e.items.items[1].el.unmask();e.taxistaOnMap(g,a)}else{Ext.MessageBox.alert("Información",g.result+". Por Favor Pide Taxi!!! Nuevamente");e.items.items[1].el.unmask()}}};c.send()}},setAddressText:function(a){this.items.items[0].items.items[0].setAddressText(a)},taxistaOnMap:function(b,a){var e=this,d=new google.maps.LatLng(b.latitud,b.longitud),c=new google.maps.InfoWindow();this.markerTaxista=this.addMarker({draggable:true,position:d,map:this.map,icon:"images/trinus.png",animation:google.maps.Animation.DROP,listeners:{dragend:function(){e.setAddressMarker(e.map,this.markerTaxista,c,this.markerTaxista.getPosition())},click:function(){c.open(e.map,this.markerTaxista)}}});this.setAddressMarker(this.map,this.markerTaxista,c,d);this.taxistaEnLugar(a);this.datosTaxista(b);this.runner=new Ext.util.TaskRunner();this.runner.start({run:this.updateTaxiPosition.bind(this,[b]),interval:10000})},updateTaxiPosition:function(b){console.log("update taxista: ");console.log(b);var c=this,d=new XMLHttpRequest(),e="idTaxista="+b[0].idTaxista+"&token="+localStorage.getItem("Logeado"),a="http://isystems.com.mx:8181/Trinus/ServletTaxista/Read?"+e;if(d){d.open("POST",a,true);d.onreadystatechange=function(f){if(f.target.readyState==4&&f.target.status==200){var h=Ext.decode(f.target.responseText);if(h.result==="ok"){console.log("ServletTaxista/Read");console.log(h);var g=latlng=new google.maps.LatLng(h.latitud,h.longitud);c.markerTaxista.setPosition(g)}}};d.send()}},addMarker:function(b){var a=new google.maps.Marker(b);Ext.Object.each(b.listeners,function(c,d){google.maps.event.addListener(a,c,d)});return a},actualizaPosicionCliente:function(a){console.log("client position");console.log(a);var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);this.markerCliente.setPosition(b);this.setAddressMarker(this.map,this.markerCliente,this.infowindow,this.markerCliente.getPosition());this.map.setCenter(b)},taxistaEnLugar:function(a){var c=this,b=[nombre=""];invocation=new XMLHttpRequest(),params="idServicio="+a+"&estatusServicio=EN EL LUGAR&token="+localStorage.getItem("Logeado"),url="http://isystems.com.mx:8181/Trinus/ServletInfoServicio?"+params;if(invocation){invocation.open("POST",url,true);invocation.onreadystatechange=function(d){if(d.target.readyState==4&&d.target.status==200){var e=Ext.decode(d.target.responseText);if(e.result==="ok"){Ext.MessageBox.alert("Información","¡Enhorabuena!, El taxi ha llegado.");c.runner.stop();c.datosTaxista(b);c.setPosicionActual(c.actualizaPosicionCliente.bind(c))}else{Ext.MessageBox.alert("Información",e.result)}}};invocation.send()}},autoCompleteOnDestino:function(a){var f=this,d=new google.maps.LatLngBounds(new google.maps.LatLng(a.coords.latitude,a.coords.longitude),new google.maps.LatLng(a.coords.latitude,a.coords.longitude));var b=document.getElementById("txtDestino-inputEl");var c={bounds:d};var e=new google.maps.places.Autocomplete(b,c);google.maps.event.addListener(e,"place_changed",function(){var g=e.getPlace().geometry.location;f.destinoOnMap({latitud:g.lat(),longitud:g.lng()})})},destinoOnMap:function(b){var e=this,d=new google.maps.LatLng(b.latitud,b.longitud),c=new google.maps.InfoWindow();var a=this.addMarker({draggable:true,position:d,map:this.map,animation:google.maps.Animation.DROP,listeners:{dragend:function(){e.setAddressMarker(e.map,a,c,a.getPosition(),true)},click:function(){c.open(e.map,a)}}});this.setAddressMarker(this.map,a,c,d,true);this.calcularRuta(b)},calcularRuta:function(a){var c=this;if(c.directionsDisplay){c.directionsDisplay.setMap(null)}c.directionsService=new google.maps.DirectionsService();c.directionsDisplay=new google.maps.DirectionsRenderer();c.directionsDisplay.setMap(c.map);var b={origin:new google.maps.LatLng(c.markerCliente.getPosition().lat(),c.markerCliente.getPosition().lng()),destination:new google.maps.LatLng(a.latitud,a.longitud),travelMode:google.maps.TravelMode.DRIVING};c.directionsService.route(b,function(e,d){if(d==google.maps.DirectionsStatus.OK){c.directionsDisplay.setDirections(e)}})},recargaSaldo:function(){this.el.mask();this.window=Ext.create("Ext.window.Window",{title:"Recarga de Credito",width:400,height:150,draggable:false,scope:this,items:[{xtype:"containerrecarga"}],listeners:{scope:this,close:function(){this.el.unmask()}}}).show()},datosTaxista:function(a){this.tplTaxista.tpl.overwrite(this.items.items[0].items.items[1].items.items[0].el,a)},deleteOverlays:function(){if(markersArray){for(i in markersArray){markersArray[i].setMap(null)}markersArray.length=0}}});Ext.define("App.view.admin.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelprincipaladmin",requires:["App.view.admin.MenuAdminPanel","App.view.admin.taxistas.Panel","App.view.admin.clientes.Panel","App.view.admin.servicios.historial.Panel","App.view.xtemplate.XtemplateTaxista","App.view.admin.servicios.asignar.Panel"],layout:"border",esSitio:undefined,initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){var c=this,b=[{iconCls:"icon-user",text:"Clientes",scope:this,cls:"Cliente"},{iconCls:"icon-hand-right",text:"Taxistas",scope:this,cls:"Taxi"},{iconCls:"icon-list-alt",text:"Historial de Servicios",scope:this,cls:"Historial"}];if(this.esSitio){b.push({iconCls:"icon-list-alt",text:"Asignar Unidades",scope:this,cls:"Asignar"})}var a=[{descargas:[],xtype:"menuadmin",region:"west",title:"Menu",id:"Menu"+this.id,bbar:this.buildBbar(),flex:1,scope:this,opciones:b,listeners:{opcion:function(e,d){c.agregarTabpanel(e,d)}}},{xtype:"tabpanel",itemId:"principalTabPanel",region:"center",flex:5,activeTab:0,items:[{title:"Mapa",html:'<div id="map_canvas" style="height: 100%; width: 100%;"></div>',listeners:{scope:this,afterrender:function(){this.setPosicionActual(this.createMap.bind(this))}}}]}];return a},buildBbar:function(){var b=this,a=["->",{xtype:"button",text:"Salir",iconCls:"icon-off icon-white",ui:"danger",scale:"medium",handler:b.salir}];return a},agregarTabpanel:function(b,a){var c=this;if(this.items.items[0].descargas.indexOf(a)==-1){this.items.items[0].descargas.push(a);this.items.items[1].add({xtype:"panel"+a,flex:1,title:b,closable:true,scope:this,id:a+this.id,esSitio:this.esSitio,listeners:{maskara:function(){c.body.mask("Cargando...")},unmaskara:function(){c.body.unmask()},destroy:function(){c.items.items[0].descargas.splice(c.items.items[0].descargas.indexOf(a),1)}}});this.items.items[1].setActiveTab(a+this.id)}else{this.items.items[1].setActiveTab(a+this.id)}},salir:function(){localStorage.removeItem("Logeado");localStorage.removeItem("recordUsuario");location.href="index.html"},setPosicionActual:function(a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a,this.gestionaErroresGeo)}else{alert("Tu navegador no soporta la API de geolocalizacion")}},createMap:function(a){var b={zoom:8,center:new google.maps.LatLng(a.coords.latitude,a.coords.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};this.infowindow=new google.maps.InfoWindow();this.arrTaxisMarkers=[];this.map=new google.maps.Map(document.getElementById("map_canvas"),b);var c=new Ext.util.TaskRunner();c.start({run:this.pedirTaxistas.bind(this),interval:1000000});if(this.esSitio){c.start({run:this.pedirServciosSitio.bind(this),interval:1000000})}},addMarker:function(b){var a=new google.maps.Marker(b);Ext.Object.each(b.listeners,function(c,d){google.maps.event.addListener(a,c,d)});return a},pedirTaxistas:function(){var a="token="+localStorage.getItem("Logeado");if(this.esSitio){a+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}Ext.data.JsonP.request({url:"http://isystems.com.mx:8181/Trinus/ServletTaxistas?"+a,scope:this,success:this.addTaxistasOnMap,failure:function(b){Ext.MessageBox.alert("Información",b.result)}})},addTaxistasOnMap:function(a){var b=this;b.tplTaxista=Ext.create("App.view.xtemplate.XtemplateTaxista",{data:{nombre:""}});Ext.each(a.data,function(d){if(d.latitud!==""){var e=new google.maps.LatLng(d.latitud,d.longitud);if(Ext.isEmpty(b.arrTaxisMarkers[d.idTaxista])){var c=b.addMarker({position:e,map:b.map,draggable:false,animation:google.maps.Animation.DROP,icon:"images/trinus.png",listeners:{click:function(){var f=new google.maps.InfoWindow({content:b.template(d)});f.open(b.map,c)}}});b.arrTaxisMarkers[d.idTaxista]=c}else{b.arrTaxisMarkers[d.idTaxista].setPosition(e)}b.map.getBounds().extend(e)}})},template:function(b){var a='<div class="media"><div style="text-align: center;"><h4 class="media-heading">Detalles del Taxista</h4></div><img height="140" style="border: 2px solid #99BBE8; width:100px; float: left;" class="media-object" src="images/man.png"><div style="padding-left: 115px;">Nombre:<br><font color="#999";>'+b.nombreCompleto+'</font><br>No. del Taxi:<br><font color="#999">'+b.unidad+'</font><br>Placas:<br><font color="#999" >'+b.placas+"</font></div></div></div>";return a},pedirServciosSitio:function(){var a="?token="+localStorage.getItem("Logeado")+"&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio;Ext.data.JsonP.request({url:"http://isystems.com.mx:8181/Trinus/ServletServicios"+a,scope:this,success:this.addNewServicios,failure:function(b){Ext.MessageBox.alert("Información",b.result)}})},addNewServicios:function(a){var b=this;Ext.each(a.data,function(e){if(e.estatus=="SIN UNIDAD"){b.agregarTabpanel("Asignar Unidades","Asignar");var d=Ext.getStore("storeAsignar"),c=d.indexOf(e);if(c==-1){d.add(e)}}})}});Ext.define("App.view.registro.FormPanel",{extend:"Ext.form.Panel",alias:"widget.formregistrarse",bodyPadding:3,buttonAlign:"center",defaults:{xtype:"textfield",labelWidth:150,allowBlank:false,vtype:"alphanum",margin:10,style:{fontFamily:"orbitron-medium"},width:380},initComponent:function(){this.items=this.buildItems();this.buttons=this.buidlButtons();this.aplicarVtypes();this.callParent(arguments)},buildItems:function(){var a=[{fieldLabel:"Nombre Completo",name:"txtName",vtype:"nombre"},{fieldLabel:"Movil",name:"txtMovil",vtype:"num",maxLength:10},{fieldLabel:"Contraseña",inputType:"password",id:"contrasena"+this.id,name:"txtPass"},{fieldLabel:"Confirmaci&oacute;n",inputType:"password",name:"txtConf"},{fieldLabel:"Email",name:"txtEmail",vtype:"email"}];return a},buidlButtons:function(){var b=this,a=[{text:"Cancelar",ui:"inverse",scale:"medium",iconCls:"icon-remove icon-white",scope:this,handler:function(){this.fireEvent("cerrarWindow")}},{scope:this,text:"Crear",ui:"warning",iconCls:"icon-ok icon-white",scale:"medium",handler:function(){if(this.form.isValid()){var c=this.form.getValues();if(c.txtPass===c.txtConf){b.registrar(c)}else{Ext.getCmp("contrasena"+b.id).markInvalid("Las contraseñas no coinciden.")}}}}];return a},registrar:function(a){var e=this,c=new XMLHttpRequest(),d="nombre_completo="+a.txtName+"&movil="+a.txtMovil+"&contrasena="+a.txtPass+"&email="+a.txtEmail,b="http://isystems.com.mx:8181/Trinus/ServletCreateClienteMovil?"+d;if(c){c.open("POST",b,true);c.onreadystatechange=function(f){if(f.target.readyState==4&&f.target.status==200){var g=Ext.decode(f.target.responseText);if(g.result==="ok"){Ext.MessageBox.alert("Información","¡Enhorabuena "+a.txtName+"!, Ahora puedes ingresar al sistema.",e.fireEvent("cerrarWindow"))}else{Ext.MessageBox.alert("Información",g.result)}}};c.send()}},aplicarVtypes:function(){Ext.apply(Ext.form.field.VTypes,{nombreMask:/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/,nombreText:"Nombre no v&aacute;lido",nombre:function(c,b){var a=/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/;return a.test(c)},numMask:/[\d\$.]/,num:function(b,a){return b}})}});Ext.define("App.view.menu.MenuPanel",{extend:"Ext.container.Container",alias:"widget.menupanel",requires:["App.view.xtemplate.XtemplateTitulo","App.view.menu.FormPanel"],initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){var a=[{flex:2,layout:"fit",xtype:"xtemplatetitulo"},{flex:6,xtype:"formpanel",layout:{type:"vbox",align:"stretch",pack:"start"},listeners:{scope:this,pedirtaxi:function(b){this.fireEvent("pedirtaxi",b)}}}];return a},setAddressText:function(a){this.items.items[1].items.items[0].setValue(a)}});Ext.define("App.view.xtemplate.XtemplateTaxista",{extend:"Ext.DataView",alias:"widget.xtemplatetaxista",style:{fontFamily:"orbitron-light",paddingTop:"20px",paddingLeft:"20px",lineHeight:"25px"},initComponent:function(){this.tpl=this.tplTaxista();this.callParent(arguments)},tplTaxista:function(){var a=new Ext.XTemplate('<tpl for="."><tpl if="nombre"><div class="media"><div style="text-align: center;"><h3 class="media-heading">Detalles del Taxista</h3></div><img height="140" style="border: 2px solid #99BBE8; width:100px; float: left;" class="media-object" src="images/man.png"><div style="padding-left: 115px;">Nombre:<br><font color="#999";> {nombre}</font><br>No. del Taxi:<br><font color="#999"> {unidad}</font><br>Placas:<br><font color="#999" > {placas}</font></div></div><tpl else><div class="media"><div style="text-align: center;"><h3 class="media-heading">Detalles del Taxista</h3><br><img id="detail-icon-img" src="http://cdn1.iconfinder.com/data/icons/customicondesignoffice2/128/FAQ.png" alt="answer, confusion, faq, question icon"></div></div></tpl></tpl>');return a}});Ext.define("App.view.recarga.FormPanel",{extend:"Ext.container.Container",alias:"widget.containerrecarga",padding:"10 0 0 20",initComponent:function(){this.html=this.buildItems();this.callParent(arguments)},buildItems:function(){return['<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_s-xclick"><table><tr><td><input type="hidden" name="on0" value="Trinus"></td><td><select name="os0"><option value="Recarga 1">Recarga 1 $5.00 MXN</option><option value="Recarga 2">Recarga 2 $30.00 MXN</option><option value="Recarga 3">Recarga 3 $50.00 MXN</option><option value="Recarga 4">Recarga 4 $200.00 MXN</option></select></td><td><input type="hidden" name="currency_code" value="MXN"><input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIIGQYJKoZIhvcNAQcEoIIICjCCCAYCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYANnFEGIL2wQAdmM4DNSpZqK9JOaX/cEEJwbvMqGktXuoSQd0OoEOdK9/WErswDerHoiUa/HFs8pgIublAMTbsqO4S6Iq3QJUMxwHizUN287vokxaN1ANjezA4BXLeYIhxmrFEKLAZqKq5PWl4YnD5FAeRJTDX4MFNt/tzsKh9D/TELMAkGBSsOAwIaBQAwggGVBgkqhkiG9w0BBwEwFAYIKoZIhvcNAwcECJ4lFPV8LDJCgIIBcCNPoeFZl7cCLuFozc7GPnMAfwqIToCxtNnUQlshv26+Z51aDHiL73S/3z4vaJz6P1BAe/mcsOLOTpqB/YNouxSIx9W0ZmrXLlrymwwWnXXp9O2Ps28figybmAZXUNCIhdjvF/egVM1d50Yw6EyYwAvQe5Xq7md9kmMakgFHWHrUjEB9cpQsRsQnqgKoNyPJjBehEaZfaLashxoizJKO8EgtMEbd+8Rgj4jmlsU1FnHZ8GgkBa3hSIqZGO3zBrRJMXoMZE0Q0mqPdfhOR7gpcMnoVl5+xPB2pxVp8wt8xMKdNEFiC8Ruxplz27Kp+xUVCRVh3KLzDD+XkBrst5GWR9ZjT44o/oqRl3SpiwPkn3Uj2R9l/Z1oIMDV5PQxo34ywww8JjWxvJR9GMQUX2GpFb46crt0h9oYwya6zpnfFz5OfVRFtJK8ctZC7OaOf9OnoMadGKOe+z+e8xjNYHdIWoznbZaDz33xwEGkCLnH3m02oIIDhzCCA4MwggLsoAMCAQICAQAwDQYJKoZIhvcNAQEFBQAwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMB4XDTA0MDIxMzEwMTMxNVoXDTM1MDIxMzEwMTMxNVowgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDBR07d/ETMS1ycjtkpkvjXZe9k+6CieLuLsPumsJ7QC1odNz3sJiCbs2wC0nLE0uLGaEtXynIgRqIddYCHx88pb5HTXv4SZeuv0Rqq4+axW9PLAAATU8w04qqjaSXgbGLP3NmohqM6bV9kZZwZLR/klDaQGo1u9uDb9lr4Yn+rBQIDAQABo4HuMIHrMB0GA1UdDgQWBBSWn3y7xm8XvVk/UtcKG+wQ1mSUazCBuwYDVR0jBIGzMIGwgBSWn3y7xm8XvVk/UtcKG+wQ1mSUa6GBlKSBkTCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb22CAQAwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOBgQCBXzpWmoBa5e9fo6ujionW1hUhPkOBakTr3YCDjbYfvJEiv/2P+IobhOGJr85+XHhN0v4gUkEDI8r2/rNk1m0GA8HKddvTjyGw/XqXa+LSTlDYkqI8OwR8GEYj4efEtcRpRYBxV8KxAW93YDWzFGvruKnnLbDAF6VR5w/cCMn5hzGCAZowggGWAgEBMIGUMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbQIBADAJBgUrDgMCGgUAoF0wGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTMwMjA1MjAwNzEwWjAjBgkqhkiG9w0BCQQxFgQUb8rJOKuHPcox7JM3RLWUjTZU6zcwDQYJKoZIhvcNAQEBBQAEgYCPqxT2oRdmGdsbRbiX5TZafn8P5/ra/LYPIFEoV6AEeBruQuk372bCTO4RDRQYNBCblD0bX1hwkzlq7Zs24Icon5i/ksHr9gfZTiUyU3cD7P4Gt3z2KAKcrdCws0w2vtpxpFEuoY30Y6wCzdyg/ZwQEYo+8x/dkO9eo30EoCVUEA==-----END PKCS7-----"><input type="image" style="margin-top: 25px; margin-left: 10px;"  src="https://www.paypalobjects.com/es_XC/MX/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal, la forma más segura y rápida de pagar en línea."><img alt="" border="0" src="https://www.paypalobjects.com/es_XC/i/scr/pixel.gif" width="1" height="1"></td></table></form>']}});Ext.define("App.view.admin.MenuAdminPanel",{extend:"Ext.panel.Panel",alias:"widget.menuadmin",frame:true,opciones:null,initComponent:function(){var a=Ext.BLANK_IMAGE_URL;var b='<ul id="task-views">';Ext.each(this.opciones,function(c){c.id=Ext.id();b+='<li>		<img style="width:20px;" src="'+a+'" class="'+c.iconCls+'"/>		<a id="'+c.id+'" class="'+c.cls+'" href="#">'+c.text+"</a></li>"},this);b+="</ul>";Ext.apply(this,{html:b});this.callParent(arguments);this.on("afterrender",this.onafterRender)},onafterRender:function(){var a=this;this.body.on("click",function(c,b){Ext.each(a.opciones,function(d){if(c.getTarget("a."+d.cls)){a.titulo=d.text;a.panel=d.cls}},a);if(this.titulo){this.fireEvent("opcion",this.titulo,this.panel)}},this)}});Ext.define("App.view.admin.taxistas.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelTaxi",requires:["App.view.admin.taxistas.GridPanel"],layout:"border",esSitio:undefined,initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[{xtype:"gridpanelfilterT",region:"center",esSitio:this.esSitio,listeners:{scope:this,mask:function(){this.items.items[0].mask("Cargando....")},unmask:function(){this.items.items[0].unmask()}}}]}});Ext.define("App.view.admin.clientes.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelCliente",requires:["App.view.admin.clientes.GridPanel"],layout:"border",esSitio:undefined,initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[this.getCentro()]},getCentro:function(){return{xtype:"gridpanelfilterC",region:"center",esSitio:this.esSitio,listeners:{scope:this,mask:function(){this.items.items[0].mask("Cargando....")},unmask:function(){this.items.items[0].unmask()}}}}});Ext.define("App.view.admin.servicios.historial.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelHistorial",requires:["App.view.admin.servicios.historial.GridPanel"],layout:"border",esSitio:undefined,initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[this.getCentro()]},getCentro:function(){return{xtype:"gridpanelfilterH",region:"center",esSitio:this.esSitio}}});Ext.define("App.view.admin.servicios.asignar.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelAsignar",requires:["App.view.admin.servicios.asignar.GridPanel"],layout:"border",esSitio:undefined,initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){return[{xtype:"gridpanelAsignar",region:"center",esSitio:this.esSitio}]}});Ext.define("App.view.xtemplate.XtemplateTitulo",{extend:"Ext.DataView",alias:"widget.xtemplatetitulo",emptyText:"No hay taxistas disponibles",tpl:"",style:{backgroundColor:"#333",lineHeight:"90px",fontSize:"80pt",fontFamily:"orbitron-medium",textAlign:"center",paddingTop:"20px"},initComponent:function(){this.tpl=this.tplTaxista();this.callParent(arguments)},tplTaxista:function(){return'<font color="FFC332">Trinus</font>'}});Ext.define("App.view.menu.FormPanel",{extend:"Ext.form.FormPanel",alias:"widget.formpanel",bodyPadding:10,defaults:{labelAlign:"top",paddingTop:30,style:{fontFamily:"orbitron-medium"}},initComponent:function(){this.items=this.buildItems();this.callParent(arguments)},buildItems:function(){var a=[{xtype:"textfield",fieldLabel:"Ubicaci&oacute;n",name:"txtOrigen",emptyText:"Ubicación"},{xtype:"textfield",fieldLabel:"Destino",id:"txtDestino",name:"txtDestino",emptyText:"No Obligatorio"},{xtype:"textarea",fieldLabel:"Observaciones",name:"txtObservaciones",emptyText:"No Obligatorio"},{xtype:"button",text:"Pedir Taxi",icon:"images/icon-1.png",flex:2,scope:this,ui:"warning",scale:"large",handler:function(){this.fireEvent("pedirtaxi",this.form.getValues())}}];return a},setAddressText:function(a){this.items.items[1].items.items[0].setValue(a)}});Ext.define("App.view.admin.taxistas.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterT",esSitio:undefined,resumida:false,viewConfig:{forceFit:true,showPreview:true,enableRowBody:true,getRowClass:function(c,a,b,e){if(c.data.estatus=="INACTIVO"){b.body="<p>"+c.data.estatus+"didier</p>";return"redUnder"}}},initComponent:function(){Ext.define("Taxi",{extend:"Ext.data.Model",fields:this.buildFields()});this.store=this.buildStore();this.columns=this.buildColumns();this.plugins=this.buildPlugins();this.dockedItems=this.buildDockedItems();this.callParent(arguments);this.getSelectionModel().on("selectionchange",function(a,b){this.down("#delete").setDisabled(b.length===0)},this)},afterRender:function(){var a=this;a.callParent(arguments);a.textField=a.down("textfield[name=searchField]")},buildStore:function(){var b="?token="+localStorage.getItem("Logeado");if(this.esSitio){b+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}var a=new Ext.data.Store({model:"Taxi",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletTaxistas"+b,reader:{type:"json",root:"data"},writer:{type:"json"}}),autoLoad:true,listeners:{scope:this,update:function(e,c,d,g){var k=this,c=c.data,h=new XMLHttpRequest(),f,j="?nombre="+c.nombreCompleto+"&contrasena="+c.contrasena+"&direccion="+c.direccion+"&telCasa="+c.movil+"&movil="+c.movil+"&email="+c.email+"&fechaNac=2013/02/11&imei="+c.imei+"&unidad="+c.unidad+"&placas="+c.placas;if(this.esSitio){j+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}if(c.idTaxista==""){k.fireEvent("mask");f="http://isystems.com.mx:8181/Trinus/ServletTaxista/Create"+j+"&token="+localStorage.getItem("Logeado");if(h){h.open("POST",f,true);h.onreadystatechange=function(l){if(l.target.readyState==4&&l.target.status==200){var m=Ext.decode(l.target.responseText);if(m.result==="ok"){k.store.load();k.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",m.result)}}};h.send()}}else{k.fireEvent("mask");f="http://isystems.com.mx:8181/Trinus/ServletTaxista/Update"+j+"&idTaxista="+c.idTaxista+"&token="+localStorage.getItem("Logeado");if(h){h.open("POST",f,true);h.onreadystatechange=function(l){if(l.target.readyState==4&&l.target.status==200){var m=Ext.decode(l.target.responseText);if(m.result==="ok"){k.store.load();k.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",m.result)}}};h.send()}}}}});return a},buildColumns:function(){var a=[{text:"Nombre",flex:1,sortable:true,dataIndex:"nombreCompleto",editor:{vtype:"nombre",allowBlank:false}},{text:"Dirección",flex:1,sortable:true,dataIndex:"direccion",editor:{vtype:"nombre",allowBlank:false},hidden:this.resumida},{text:"Movil",flex:1,sortable:true,dataIndex:"movil",editor:{vtype:"num",allowBlank:false}},{text:"Email",flex:1,sortable:true,dataIndex:"email",editor:{vtype:"email",allowBlank:false},hidden:this.resumida},{text:"Imei",flex:1,sortable:true,dataIndex:"imei",editor:{vtype:"num",allowBlank:false},hidden:this.resumida},{text:"Unidad",flex:1,sortable:true,dataIndex:"unidad",editor:{vtype:"alphanum",allowBlank:false}},{text:"Placas",flex:1,sortable:true,dataIndex:"placas",editor:{vtype:"alphanum",allowBlank:false}},{text:"Contraseña",flex:1,sortable:true,dataIndex:"contrasena",editor:{vtype:"alphanum",allowBlank:false},hidden:this.resumida},{text:"Estatus",flex:1,sortable:true,dataIndex:"estatus"}];return a},buildPlugins:function(){var a=Ext.create("Ext.grid.plugin.RowEditing");return[a]},buildDockedItems:function(){var a=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Agregar",ui:"success",iconCls:"icon-plus icon-white",hidden:a.esSitio,handler:function(){a.store.insert(0,new Taxi());a.plugins[0].startEdit(0,0)}},"-",{itemId:"delete",text:"Desactivar",ui:"danger",iconCls:"icon-remove icon-white",hidden:a.esSitio,disabled:true,handler:function(){var c=a.getView().getSelectionModel().getSelection()[0];if(c){var b=c.data,d=new XMLHttpRequest(),e="?idTaxista="+b.idTaxista+"&token="+localStorage.getItem("Logeado");if(this.esSitio){e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}a.fireEvent("mask");if(b.idTaxista!=""){if(d){d.open("POST","http://isystems.com.mx:8181/Trinus/ServletTaxista/Delete"+e,true);d.onreadystatechange=function(f){if(f.target.readyState==4&&f.target.status==200){var g=Ext.decode(f.target.responseText);if(g.result==="ok"){a.store.load();a.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",g.result)}}};d.send()}}a.store.remove(c);a.store.load();a.fireEvent("unmask")}}},"-",{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",hidden:a.esSitio,handler:function(){a.fireEvent("mask");a.store.load();a.fireEvent("unmask")}},"->",{xtype:"textfield",fieldLabel:"Buscar",listeners:{scope:this,change:this.spotLight}}]}]},buildBbar:function(){var j=this,a,c,b,k,h,g,f,e,d;c=j.buildTextField("nombreCompleto","nombre");b=j.buildTextField("direccion","nombre");k=j.buildTextField("movil","num");h=j.buildTextField("email","email");g=j.buildTextField("imei","num");f=j.buildTextField("unidad","alphanum");e=j.buildTextField("placas","alphanum");d=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,iconCls:"icon-refresh icon-white",scope:this,handler:j.resetSearchs});a=[c,b,k,h,g,f,e,d];return a},buildTextField:function(b,d){var c=this,a={xtype:"textfield",id:b+c.id,flex:1,vtype:d,emptyText:b,listeners:{scope:this,change:c.filterStore}};return a},filterStore:function(){var c=this,b,d,a=["nombreCompleto","direccion","movil","email","imei","unidad","placas"];c.store.clearFilter(false);for(b=0;b<a.length;b++){d=Ext.getCmp(a[b]+c.id).getValue();if(!Ext.isEmpty(d)){c.store.filter(a[b],d,true,false)}}},buildFields:function(){var a=[{name:"idTaxista",type:"string"},{name:"nombreCompleto",type:"string"},{name:"direccion",type:"string"},{name:"movil",type:"string"},{name:"email",type:"string"},{name:"imei",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"contrasena",type:"string"},{name:"estatus",type:"string"}];return a},resetSearchs:function(){var c=this,b,a=["nombreCompleto","direccion","movil","email","imei","unidad","placas"];c.store.clearFilter(false);for(b=0;b<a.length;b++){Ext.getCmp(a[b]+c.id).reset()}},spotLight:function(b,f,a,d){var c=this;c.store.clearFilter(true);c.store.filterBy(function(e){if(e.get("nombreCompleto").search(f)!=-1||e.get("movil").search(f)!=-1||e.get("email").search(f)!=-1||e.get("contrasena").search(f)!=-1||e.get("direccion").search(f)!=-1||e.get("unidad").search(f)!=-1||e.get("imei").search(f)!=-1||e.get("placas").search(f)!=-1){return true}},this)}});Ext.define("App.view.admin.clientes.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterC",esSitio:undefined,viewConfig:{forceFit:true,showPreview:true,enableRowBody:true,getRowClass:function(c,a,b,e){if(c.data.estatus=="INACTIVO"){b.body="<p>"+c.data.estatus+"didier</p>";return"redUnder"}}},initComponent:function(){Ext.define("Cliente",{extend:"Ext.data.Model",fields:this.buildFields()});this.store=this.buildStore();this.columns=this.buildColumns();this.plugins=this.buildPlugins();this.dockedItems=this.buildDockedItems();this.callParent(arguments);this.getSelectionModel().on("selectionchange",function(a,b){this.down("#delete").setDisabled(b.length===0)},this)},afterRender:function(){var a=this;a.callParent(arguments);a.textField=a.down("textfield[name=searchField]")},buildStore:function(){var b="?token="+localStorage.getItem("Logeado");if(this.esSitio){b+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitito}var a=new Ext.data.Store({model:"Cliente",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletClientes"+b,reader:{type:"json",root:"data"},writer:{type:"json"}}),autoLoad:true,listeners:{scope:this,update:function(e,c,d,g){var k=this,c=c.data,h=new XMLHttpRequest(),f,j="nombre="+c.nombreCompleto+"&contrasena="+c.contrasena+"&movil="+c.movil+"&email="+c.email;if(this.esSitio){j+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}if(c.idCliente==""){k.fireEvent("mask");f="http://isystems.com.mx:8181/Trinus/ServletCliente/Create?"+j+"&token="+localStorage.getItem("Logeado");if(h){h.open("POST",f,true);h.onreadystatechange=function(l){if(l.target.readyState==4&&l.target.status==200){var m=Ext.decode(l.target.responseText);if(m.result==="ok"){k.store.load();k.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",m.result);k.store.load();k.fireEvent("unmask")}}};h.send()}}else{k.fireEvent("mask");f="http://isystems.com.mx:8181/Trinus/ServletCliente/Update?"+j+"&idCliente="+c.idCliente+"&token="+localStorage.getItem("Logeado");if(h){h.open("POST",f,true);h.onreadystatechange=function(l){if(l.target.readyState==4&&l.target.status==200){var m=Ext.decode(l.target.responseText);if(m.result==="ok"){k.store.load();k.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",m.result)}}};h.send()}}}}});return a},buildColumns:function(){var a=[{text:"Nombre",flex:1,sortable:true,dataIndex:"nombreCompleto",editor:{vtype:"nombre",allowBlank:false}},{text:"Movil",flex:1,sortable:true,dataIndex:"movil",editor:{vtype:"num",allowBlank:false}},{text:"Email",flex:1,sortable:true,dataIndex:"email",editor:{vtype:"email",allowBlank:false}},{text:"Contraseña",flex:1,sortable:true,dataIndex:"contrasena",editor:{vtype:"alphanum",allowBlank:false}},{text:"Estatus",flex:1,sortable:true,dataIndex:"estatus"}];return a},buildPlugins:function(){var a=Ext.create("Ext.grid.plugin.RowEditing");return[a]},buildDockedItems:function(){var a=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Agregar",ui:"success",handler:function(){a.store.insert(0,new Cliente());a.plugins[0].startEdit(0,0)}},"-",{itemId:"delete",text:"Desactivar",ui:"danger",disabled:true,handler:function(){var c=a.getView().getSelectionModel().getSelection()[0];if(c){var b=c.data,d=new XMLHttpRequest(),e="?idCliente="+b.idCliente+"&token="+localStorage.getItem("Logeado");if(this.esSitio){e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}a.fireEvent("mask");if(b.idCliente!=""){if(d){d.open("POST","http://isystems.com.mx:8181/Trinus/ServletCliente/Delete"+e,true);d.onreadystatechange=function(f){if(f.target.readyState==4&&f.target.status==200){var g=Ext.decode(f.target.responseText);if(g.result==="ok"){a.store.load();a.fireEvent("unmask")}else{Ext.MessageBox.alert("Información",g.result)}}};d.send()}}a.store.remove(c);a.store.load();a.fireEvent("unmask")}}},"-",{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",handler:function(){a.fireEvent("mask");a.store.load();a.fireEvent("unmask")}},"->",{xtype:"textfield",fieldLabel:"Buscar",listeners:{scope:this,change:this.spotLight}}]}]},buildBbar:function(){var e=this,d,f,c,a,b;f=e.buildTextField("nombreCompleto","nombre");c=e.buildTextField("movil","num");a=e.buildTextField("email","email");b=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,scope:this,handler:e.resetSearchs});d=[f,c,a,b];return d},buildTextField:function(b,d){var c=this,a={xtype:"textfield",id:b+c.id,flex:1,vtype:d,emptyText:b,listeners:{scope:this,change:c.filterStore}};return a},filterStore:function(){var c=this,b,d,a=["nombreCompleto","movil","email"];c.store.clearFilter(false);for(b=0;b<a.length;b++){d=Ext.getCmp(a[b]+c.id).getValue();if(!Ext.isEmpty(d)){c.store.filter(a[b],d,true,false)}}},buildFields:function(){var a=[{name:"idCliente",type:"string"},{name:"nombreCompleto",type:"string"},{name:"movil",type:"string"},{name:"email",type:"string"},{name:"contrasena",type:"string"},{name:"estatus",type:"string"}];return a},resetSearchs:function(){var c=this,b,a=["nombreCompleto","movil","email"];c.store.clearFilter(false);for(b=0;b<a.length;b++){Ext.getCmp(a[b]+c.id).reset()}},spotLight:function(b,f,a,d){var c=this;c.store.clearFilter(true);c.store.filterBy(function(e){if(e.get("nombreCompleto").search(f)!=-1||e.get("movil").search(f)!=-1||e.get("email").search(f)!=-1||e.get("contrasena").search(f)!=-1||e.get("estatus").search(f)!=-1){return true}},this)}});Ext.define("App.view.admin.servicios.historial.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterH",esSitio:undefined,initComponent:function(){var a=this;Ext.define("Historial",{extend:"Ext.data.Model",fields:this.buildFields()});this.store=this.buildStore();this.columns=this.buildColumns();this.dockedItems=this.buildDockedItems();this.bbar=this.buildBbar();this.callParent(arguments)},buildColumns:function(){var a=[{text:"Nombre Cliente",flex:1,sortable:true,dataIndex:"nombreCliente"},{text:"Nombre Taxista",flex:1,sortable:true,dataIndex:"nombreTaxista"},{text:"Dirección",flex:1,sortable:true,dataIndex:"direccion"},{text:"Unidad",flex:1,sortable:true,dataIndex:"unidad"},{text:"Placas",flex:1,sortable:true,dataIndex:"placas"},{text:"Fecha",flex:1,sortable:true,dataIndex:"fechaHora"},{text:"Estatus",flex:1,sortable:true,dataIndex:"estatus"},{text:"Observaciones",flex:1,sortable:true,dataIndex:"observaciones"}];return a},buildStore:function(){var b="?token="+localStorage.getItem("Logeado");if(this.esSitio){b+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio}var a=new Ext.data.Store({model:"Historial",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletServicios"+b,reader:{type:"json",root:"data"}}),autoLoad:true});return a},buildFields:function(){var a=[{name:"nombreCliente",type:"string"},{name:"nombreTaxista",type:"string"},{name:"direccion",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"fechaHora",type:"string"},{name:"estatus",type:"string"},{name:"observaciones",type:"string"}];return a},buildDockedItems:function(){var a=this;return[{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",handler:function(){a.fireEvent("mask");a.store.load();a.fireEvent("unmask")}}]},buildBbar:function(){var j=this,a,c,b,k,h,g,f,e,d;c=j.buildTextField("nombreTaxista","nombre");b=j.buildTextField("nombreCliente","nombre");k=j.buildDateField("fechaHora");h=j.buildCombo("estatus","estatus");d=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,iconCls:"icon-refresh icon-white",scope:this,handler:j.resetSearchs});a=[c,b,k,h,d];return a},buildTextField:function(b,d){var c=this,a={xtype:"textfield",id:b+c.id,flex:1,vtype:d,emptyText:b,listeners:{scope:this,change:c.filterStore}};return a},filterStore:function(){var c=this,b,d,a=["nombreTaxista","nombreCliente","fechaHora","estatus"];c.store.clearFilter(false);for(b=0;b<a.length;b++){d=Ext.getCmp(a[b]+c.id).getValue();if(!Ext.isEmpty(d)){c.store.filter(a[b],d,true,false)}}},buildDateField:function(a,d){var c=this,b={xtype:"datefield",id:a+c.id,flex:1,emptyText:a,listeners:{scope:this,change:c.filterStore}};return b},buildCombo:function(a,b){var c=this,d;d=Ext.create("Ext.form.ComboBox",{id:b+this.id,store:c.buildStore().collect(b),emptyText:a,displayField:b,valueField:b,queryMode:"local",flex:1,listeners:{scope:this,change:function(h,e,g,f){c.filterStore()}}});return d},resetSearchs:function(){var c=this,b,a=["nombreTaxista","nombreCliente","fechaHora","estatus"];c.store.clearFilter(false);for(b=0;b<a.length;b++){Ext.getCmp(a[b]+c.id).reset()}}});Ext.define("App.view.admin.servicios.asignar.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelAsignar",requires:["App.view.admin.taxistas.GridPanel"],initComponent:function(){Ext.define("Servicio",{extend:"Ext.data.Model",fields:this.buildFields()});this.store=this.buildStore();this.columns=this.buildColumns();this.dockedItems=this.buildDockedItems();this.callParent(arguments)},buildColumns:function(){var a=[{text:"Nombre Cliente",flex:1,sortable:true,dataIndex:"nombreCliente"},{text:"Nombre Taxista",flex:1,sortable:true,dataIndex:"nombreTaxista",hidden:this.esSitio},{text:"Dirección",flex:1,sortable:true,dataIndex:"direccion"},{text:"Unidad",flex:1,sortable:true,dataIndex:"unidad",hidden:this.esSitio},{text:"Placas",flex:1,sortable:true,dataIndex:"placas",hidden:this.esSitio},{text:"Fecha",flex:1,sortable:true,dataIndex:"fechaHora"},{text:"Estatus",flex:1,sortable:true,dataIndex:"estatus"},{text:"Observaciones",flex:1,sortable:true,dataIndex:"observaciones"}];return a},buildDockedItems:function(){var a=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Asignar Taxi",ui:"success",iconCls:"icon-add icon-white",handler:a.asignarTaxi.bind(a)}]}]},buildFields:function(){var a=[{name:"idServicio",type:"int"},{name:"idTaxista",type:"int"},{name:"nombreCliente",type:"string"},{name:"nombreTaxista",type:"string"},{name:"direccion",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"fechaHora",type:"string"},{name:"estatus",type:"string"},{name:"observaciones",type:"string"}];return a},buildStore:function(){var a=new Ext.data.Store({model:"Servicio",storeId:"storeAsignar",data:[]});return a},asignarTaxi:function(){var b=this,a=this.getSelectionModel().getSelection();if(a[0]){var c=Ext.create("Ext.window.Window",{title:"Buscar Taxista",id:"windowBuscarTaxista"+this.id,modal:true,width:600,height:450,items:[{xtype:"gridpanelfilterT",resumida:true,esSitio:b.esSitio}],buttons:[{text:"Aceptar",handler:this.onSeleccionarTaxi.bind(b)},{text:"Cancelar",scope:this,handler:function(){c.close()}}]});c.show()}else{Ext.MessageBox.alert("Información","Debes seleccionar un Servicio.")}},onSeleccionarTaxi:function(d){var f=this,e=Ext.getCmp("windowBuscarTaxista"+f.id),c=e.down("gridpanelfilterT"),j=f.getSelectionModel().getSelection(),g=c.getSelectionModel().getSelection();if(g[0]){var b="?token="+localStorage.getItem("Logeado")+"&idServicio="+j[0].data.idServicio+"&idTaxista="+g[0].data.idTaxista;var h=new XMLHttpRequest(),a="http://isystems.com.mx:8181/Trinus/ServletOperadoraSitio"+b;if(h){h.open("POST",a,true);h.onreadystatechange=function(k){if(k.target.readyState==4&&k.target.status==200){var l=Ext.decode(k.target.responseText);console.log("respuesta ServletOperadoraSitio"+l);if(l.result=="ok"){f.getStore().remove(j[0]);e.close();Ext.MessageBox.alert("Información","!Enhorabuena el servicio ha sido asignado¡")}}};h.send()}}else{Ext.MessageBox.alert("Información","Selecciona un taxista para continuar.")}}});

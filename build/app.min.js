Ext.Loader.setConfig({enabled:!0}),Ext.application({name:"Trinus",defaults:{},launch:function(){localStorage.getItem("Logeado")?this.iniciar():this.window=Ext.create("Ext.window.Window",{title:"Bienvenido!!!",width:310,height:220,layout:"fit",closable:!1,draggable:!1,items:[{xtype:"formpanellogin",listeners:{scope:this,logeado:this.iniciar}}]}).show()},iniciar:function(){this.window&&this.window.destroy();var e=Ext.decode(localStorage.getItem("Usuario")),t="",i=!1;switch(e.tipo){case"0":t="panelprincipaladmin";break;case"1":t="panelprincipal";break;case"3":t="panelprincipaladmin",i=!0}Ext.create("Ext.container.Viewport",{layout:"fit",items:[{xtype:t,esSitio:i}]})}}),Ext.define("App.view.login.FormPanel",{extend:"Ext.form.Panel",alias:"widget.formpanellogin",bodyPadding:10,buttonAlign:"center",defaults:{xtype:"textfield",margin:5,allowBlank:!1,labelWidth:110,style:{fontFamily:"orbitron-medium"}},initComponent:function(){this.items=this.buildItems(),this.buttons=this.buidlButtons(),this.callParent(arguments)},buildItems:function(){var e=[{fieldLabel:"Movil",name:"txtMovil",value:"5555555555"},{fieldLabel:"Password",inputType:"password",name:"txtPass",value:"trinus",listeners:{scope:this,specialkey:function(e,t){t.getKey()==t.ENTER&&this.logeo()}}}];return e},buidlButtons:function(){var e=[{text:"Registrate",ui:"inverse",scale:"medium",iconCls:"icon-user icon-white",scope:this,handler:this.windowRegistrarse},{scope:this,text:"Ingresa",ui:"warning",scale:"medium",iconCls:"icon-ok icon-white",handler:this.logeo}];return e},logeo:function(){var e=this.getForm(),t=e.getValues();if(e.isValid()){var i=new XMLHttpRequest,a="http://isystems.com.mx:8181/Trinus/ServletLogin?movil="+t.txtMovil+"&password="+t.txtPass;i&&(i.open("POST",a,!0),i.onreadystatechange=this.logear.bind(this),i.send())}},logear:function(e){if(4==e.target.readyState&&200==e.target.status){var t=Ext.decode(e.target.responseText);"ok"===t.result?(localStorage.setItem("Logeado",t.token),localStorage.setItem("Usuario",Ext.encode(t)),this.fireEvent("logeado",t)):Ext.MessageBox.alert("Status",t.result)}},windowRegistrarse:function(){this.fireEvent("mask"),this.window=Ext.create("Ext.window.Window",{title:"Ingresa tus Datos",width:415,height:336,draggable:!1,layout:"fit",items:[{xtype:"formregistrarse",listeners:{scope:this,cerrarWindow:function(){this.window.close()}}}]}).show()}}),Ext.define("App.view.principal.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelprincipal",layout:"border",initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){this.tplTaxista=Ext.create("App.view.xtemplate.XtemplateTaxista",{data:{nombre:""}});var e=[{xtype:"panel",region:"east",bbar:this.buildBbar(),flex:2,layout:{type:"vbox",align:"stretch",pack:"start"},items:[{flex:7,xtype:"menupanel",layout:{type:"vbox",align:"stretch",pack:"start"},listeners:{scope:this,pedirtaxi:this.pedirTaxi}},{flex:4,xtype:"container",items:[this.tplTaxista]}]},{xtype:"container",region:"center",flex:5,html:'<div id="map_canvas" style="height: 100%; width: 100%;"></div>',listeners:{scope:this,afterrender:function(){this.setPosicionActual(this.createMap.bind(this))}}}];return e},buildBbar:function(){var e=this,t=Ext.create("Ext.toolbar.Toolbar",{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Posición",flex:1,ui:"inverse",iconCls:"icon-map-marker icon-white",scale:"medium",handler:function(){e.setPosicionActual(e.actualizaPosicionCliente.bind(e))}},{xtype:"button",text:"Recarga",flex:1,ui:"warning",iconCls:"icon-shopping-cart icon-white",scale:"medium",scope:this,handler:e.recargaSaldo},{xtype:"button",text:"Salir",flex:1,ui:"inverse",iconCls:"icon-off icon-white",scale:"medium",handler:e.salir}]});return t},salir:function(){localStorage.removeItem("Logeado"),localStorage.removeItem("Usuario"),location.href="index.html"},setPosicionActual:function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,this.gestionaErroresGeo):alert("Tu navegador no soporta la API de geolocalizacion")},createMap:function(e){console.log("actual position: "),console.log(e);var t=this,i={zoom:14,center:new google.maps.LatLng(e.coords.latitude,e.coords.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP},a=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.infowindow=new google.maps.InfoWindow,this.map=new google.maps.Map(document.getElementById("map_canvas"),i),this.markerCliente=this.addMarker({draggable:!0,position:a,map:this.map,animation:google.maps.Animation.DROP,listeners:{dragend:function(){t.setAddressMarker(t.map,t.markerCliente,t.infowindow,t.markerCliente.getPosition())},click:function(){t.infowindow.open(t.map,t.markerCliente)}}}),this.setAddressMarker(this.map,t.markerCliente,t.infowindow,a),this.autoCompleteOnDestino(e)},setAddressMarker:function(e,t,i,a,n){var o=this,s=new google.maps.Geocoder;s.geocode({latLng:a},function(a,s){if(s==google.maps.GeocoderStatus.OK&&a[0]){var r=a[0].formatted_address;e.setZoom(16),i.setContent(r),i.setOptions({maxWidth:150}),i.open(e,t),n||o.setAddressText(r)}})},gestionaErroresGeo:function(e){0==e.code&&alert("error desconocido"),1==e.code&&alert("El usuario no ha compartido su posicion"),2==e.code&&alert("no se puede obtener la posicion actual"),3==e.code&&alert("timeout recibiendo la posicion")},pedirTaxi:function(e){var t=this,i=new XMLHttpRequest,a=t.markerCliente.getPosition(),n="idCliente="+Ext.decode(localStorage.getItem("Usuario")).idCliente+"&direccion="+e.txtOrigen+"&latitud="+a.lat()+"&longitud="+a.lng()+"&observ="+e.txtObservaciones+"&token="+localStorage.getItem("Logeado"),o="http://isystems.com.mx:8181/Trinus/ServletServicioMovil?"+n;i&&(i.open("POST",o,!0),i.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var i=Ext.decode(e.target.responseText);"ok"===i.result?Ext.MessageBox.alert("Información","La petición se ha procesado con éxito.",t.pedirDatosTaxi.bind(t,i.idServicio)):Ext.MessageBox.alert("Información",i.result)}},i.send())},pedirDatosTaxi:function(e){var t=this,i=new XMLHttpRequest,a="idServicio="+e+"&estatus=ACEPTADO&token="+localStorage.getItem("Logeado"),n="http://isystems.com.mx:8181/Trinus/DatosTaxista?"+a;t.items.items[1].el.mask("Buscando al taxista mas cercano, por favor espere..."),i&&(i.open("POST",n,!0),i.onreadystatechange=function(i){if(4==i.target.readyState&&200==i.target.status){var a=Ext.decode(i.target.responseText);"ok"===a.result?(t.items.items[1].el.unmask(),t.taxistaOnMap(a,e)):(Ext.MessageBox.alert("Información",a.result+". Por Favor Pide Taxi!!! Nuevamente"),t.items.items[1].el.unmask())}},i.send())},setAddressText:function(e){this.items.items[0].items.items[0].setAddressText(e)},taxistaOnMap:function(e,t){var i=this,a=new google.maps.LatLng(e.latitud,e.longitud),n=new google.maps.InfoWindow;this.markerTaxista=this.addMarker({draggable:!0,position:a,map:this.map,icon:"images/trinus.png",animation:google.maps.Animation.DROP,listeners:{dragend:function(){i.setAddressMarker(i.map,this.markerTaxista,n,this.markerTaxista.getPosition())},click:function(){n.open(i.map,this.markerTaxista)}}}),this.setAddressMarker(this.map,this.markerTaxista,n,a),this.datosTaxista(e),this.runner=new Ext.util.TaskRunner,this.runner.start({run:this.updateTaxiPosition.bind(this,[e]),interval:1e4}),this.taxistaEnLugar(t)},updateTaxiPosition:function(e){console.log("update taxista: "),console.log(e);var t=this,i=new XMLHttpRequest,a="idTaxista="+e[0].idTaxista+"&token="+localStorage.getItem("Logeado"),n="http://isystems.com.mx:8181/Trinus/ServletTaxista/Read?"+a;i&&(i.open("POST",n,!0),i.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var i=Ext.decode(e.target.responseText);if("ok"===i.result){console.log("ServletTaxista/Read"),console.log(i);var a=latlng=new google.maps.LatLng(i.latitud,i.longitud);t.markerTaxista.setPosition(a)}}},i.send())},addMarker:function(e){var t=new google.maps.Marker(e);return Ext.Object.each(e.listeners,function(e,i){google.maps.event.addListener(t,e,i)}),t},actualizaPosicionCliente:function(e){console.log("client position"),console.log(e);var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.markerCliente.setPosition(t),this.setAddressMarker(this.map,this.markerCliente,this.infowindow,this.markerCliente.getPosition()),this.map.setCenter(t)},taxistaEnLugar:function(e){var t=this,i=[nombre=""];invocation=new XMLHttpRequest,params="idServicio="+e+"&estatusServicio=EN EL LUGAR&token="+localStorage.getItem("Logeado"),url="http://isystems.com.mx:8181/Trinus/ServletInfoServicio?"+params,invocation&&(invocation.open("POST",url,!0),invocation.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var a=Ext.decode(e.target.responseText);"ok"===a.result?(Ext.MessageBox.alert("Información","¡Enhorabuena!, El taxi ha llegado."),t.runner.destroy(),t.markerTaxista.setMap(null),t.datosTaxista(i),t.setPosicionActual(t.actualizaPosicionCliente.bind(t))):Ext.MessageBox.alert("Información",a.result)}},invocation.send())},autoCompleteOnDestino:function(e){var t=this,i=new google.maps.LatLngBounds(new google.maps.LatLng(e.coords.latitude,e.coords.longitude),new google.maps.LatLng(e.coords.latitude,e.coords.longitude)),a=document.getElementById("txtDestino-inputEl"),n={bounds:i},o=new google.maps.places.Autocomplete(a,n);google.maps.event.addListener(o,"place_changed",function(){var e=o.getPlace().geometry.location;t.destinoOnMap({latitud:e.lat(),longitud:e.lng()})})},destinoOnMap:function(e){var t=this,i=new google.maps.LatLng(e.latitud,e.longitud),a=new google.maps.InfoWindow,n=this.addMarker({draggable:!0,position:i,map:this.map,animation:google.maps.Animation.DROP,listeners:{dragend:function(){t.setAddressMarker(t.map,n,a,n.getPosition(),!0)},click:function(){a.open(t.map,n)}}});this.setAddressMarker(this.map,n,a,i,!0),this.calcularRuta(e)},calcularRuta:function(e){var t=this;t.directionsDisplay&&t.directionsDisplay.setMap(null),t.directionsService=new google.maps.DirectionsService,t.directionsDisplay=new google.maps.DirectionsRenderer,t.directionsDisplay.setMap(t.map);var i={origin:new google.maps.LatLng(t.markerCliente.getPosition().lat(),t.markerCliente.getPosition().lng()),destination:new google.maps.LatLng(e.latitud,e.longitud),travelMode:google.maps.TravelMode.DRIVING};t.directionsService.route(i,function(e,i){i==google.maps.DirectionsStatus.OK&&t.directionsDisplay.setDirections(e)})},recargaSaldo:function(){this.el.mask(),this.window=Ext.create("Ext.window.Window",{title:"Recarga de Credito",width:400,height:150,draggable:!1,scope:this,items:[{xtype:"containerrecarga"}],listeners:{scope:this,close:function(){this.el.unmask()}}}).show()},datosTaxista:function(e){this.tplTaxista.tpl.overwrite(this.items.items[0].items.items[1].items.items[0].el,e)}}),Ext.define("App.view.admin.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelprincipaladmin",layout:"border",esSitio:void 0,initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){var e=this,t=[{iconCls:"icon-user",text:"Clientes",scope:this,cls:"Cliente"},{iconCls:"icon-hand-right",text:"Taxistas",scope:this,cls:"Taxi"},{iconCls:"icon-list-alt",text:"Historial de Servicios",scope:this,cls:"Historial"}];this.esSitio&&t.push({iconCls:"icon-list-alt",text:"Asignar Unidades",scope:this,cls:"Asignar"});var i=[{descargas:[],xtype:"menuadmin",region:"west",title:"Menu",id:"Menu"+this.id,bbar:this.buildBbar(),flex:1,scope:this,opciones:t,listeners:{opcion:function(t,i){e.agregarTabpanel(t,i)}}},{xtype:"tabpanel",itemId:"principalTabPanel",region:"center",flex:5,activeTab:0,items:[{title:"Mapa",html:'<div id="map_canvas" style="height: 100%; width: 100%;"></div>',listeners:{scope:this,afterrender:function(){this.setPosicionActual(this.createMap.bind(this))}}}]}];return i},buildBbar:function(){var e=this,t=["->",{xtype:"button",text:"Salir",iconCls:"icon-off icon-white",ui:"danger",scale:"medium",handler:e.salir}];return t},agregarTabpanel:function(e,t){var i=this;-1==this.items.items[0].descargas.indexOf(t)?(this.items.items[0].descargas.push(t),this.items.items[1].add({xtype:"panel"+t,flex:1,title:e,closable:!0,scope:this,id:t+this.id,esSitio:this.esSitio,listeners:{maskara:function(){i.body.mask("Cargando...")},unmaskara:function(){i.body.unmask()},destroy:function(){i.items.items[0].descargas.splice(i.items.items[0].descargas.indexOf(t),1)}}}),this.items.items[1].setActiveTab(t+this.id)):this.items.items[1].setActiveTab(t+this.id)},salir:function(){localStorage.removeItem("Logeado"),localStorage.removeItem("recordUsuario"),location.href="index.html"},setPosicionActual:function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,this.gestionaErroresGeo):alert("Tu navegador no soporta la API de geolocalizacion")},createMap:function(e){var t={zoom:8,center:new google.maps.LatLng(e.coords.latitude,e.coords.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};this.infowindow=new google.maps.InfoWindow,this.arrTaxisMarkers=[],this.map=new google.maps.Map(document.getElementById("map_canvas"),t);var i=new Ext.util.TaskRunner;i.start({run:this.pedirTaxistas.bind(this),interval:1e6}),this.esSitio&&i.start({run:this.pedirServciosSitio.bind(this),interval:5e3})},addMarker:function(e){var t=new google.maps.Marker(e);return Ext.Object.each(e.listeners,function(e,i){google.maps.event.addListener(t,e,i)}),t},pedirTaxistas:function(){var e="token="+localStorage.getItem("Logeado");this.esSitio&&(e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio),Ext.data.JsonP.request({url:"http://isystems.com.mx:8181/Trinus/ServletTaxistas?"+e,scope:this,success:this.addTaxistasOnMap,failure:function(e){Ext.MessageBox.alert("Información",e.result)}})},addTaxistasOnMap:function(e){var t=this;t.tplTaxista=Ext.create("App.view.xtemplate.XtemplateTaxista",{data:{nombre:""}}),Ext.each(e.data,function(e){if(""!==e.latitud){var i=new google.maps.LatLng(e.latitud,e.longitud);if(Ext.isEmpty(t.arrTaxisMarkers[e.idTaxista])){var a=t.addMarker({position:i,map:t.map,draggable:!1,animation:google.maps.Animation.DROP,icon:"images/trinus.png",listeners:{click:function(){var i=new google.maps.InfoWindow({content:t.template(e)});i.open(t.map,a)}}});t.arrTaxisMarkers[e.idTaxista]=a}else t.arrTaxisMarkers[e.idTaxista].setPosition(i);t.map.getBounds().extend(i)}})},template:function(e){var t='<div class="media"><div style="text-align: center;"><h4 class="media-heading">Detalles del Taxista</h4></div><img height="140" style="border: 2px solid #99BBE8; width:100px; float: left;" class="media-object" src="images/man.png"><div style="padding-left: 115px;">Nombre:<br><font color="#999";>'+e.nombreCompleto+"</font><br>"+'No. del Taxi:<br><font color="#999">'+e.unidad+"</font><br>"+'Placas:<br><font color="#999" >'+e.placas+"</font></div>"+"</div>"+"</div>";return t},pedirServciosSitio:function(){var e="?token="+localStorage.getItem("Logeado")+"&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio;Ext.data.JsonP.request({url:"http://isystems.com.mx:8181/Trinus/ServletServicios"+e,scope:this,success:this.addNewServicios,failure:function(e){Ext.MessageBox.alert("Información",e.result)}})},addNewServicios:function(e){var t=this;Ext.each(e.data,function(e){if("ASIGNADO"==e.estatus){t.agregarTabpanel("Asignar Unidades","Asignar");var i=Ext.getStore("storeAsignar"),a=i.findRecord("idServicio",e.idServicio);a||i.add(e)}})}}),Ext.define("App.view.registro.FormPanel",{extend:"Ext.form.Panel",alias:"widget.formregistrarse",bodyPadding:3,buttonAlign:"center",defaults:{xtype:"textfield",labelWidth:150,allowBlank:!1,vtype:"alphanum",margin:10,style:{fontFamily:"orbitron-medium"},width:380},initComponent:function(){this.items=this.buildItems(),this.buttons=this.buidlButtons(),this.aplicarVtypes(),this.callParent(arguments)},buildItems:function(){var e=[{fieldLabel:"Nombre Completo",name:"txtName",vtype:"nombre"},{fieldLabel:"Movil",name:"txtMovil",vtype:"num",maxLength:10},{fieldLabel:"Contraseña",inputType:"password",id:"contrasena"+this.id,name:"txtPass"},{fieldLabel:"Confirmaci&oacute;n",inputType:"password",name:"txtConf"},{fieldLabel:"Email",name:"txtEmail",vtype:"email"}];return e},buidlButtons:function(){var e=this,t=[{text:"Cancelar",ui:"inverse",scale:"medium",iconCls:"icon-remove icon-white",scope:this,handler:function(){this.fireEvent("cerrarWindow")}},{scope:this,text:"Crear",ui:"warning",iconCls:"icon-ok icon-white",scale:"medium",handler:function(){if(this.form.isValid()){var t=this.form.getValues();t.txtPass===t.txtConf?e.registrar(t):Ext.getCmp("contrasena"+e.id).markInvalid("Las contraseñas no coinciden.")}}}];return t},registrar:function(e){var t=this,i=new XMLHttpRequest,a="nombre_completo="+e.txtName+"&movil="+e.txtMovil+"&contrasena="+e.txtPass+"&email="+e.txtEmail,n="http://isystems.com.mx:8181/Trinus/ServletCreateClienteMovil?"+a;i&&(i.open("POST",n,!0),i.onreadystatechange=function(i){if(4==i.target.readyState&&200==i.target.status){var a=Ext.decode(i.target.responseText);"ok"===a.result?Ext.MessageBox.alert("Información","¡Enhorabuena "+e.txtName+"!, Ahora puedes ingresar al sistema.",t.fireEvent("cerrarWindow")):Ext.MessageBox.alert("Información",a.result)}},i.send())},aplicarVtypes:function(){Ext.apply(Ext.form.field.VTypes,{nombreMask:/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/,nombreText:"Nombre no v&aacute;lido",nombre:function(e){var t=/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/;return t.test(e)},numMask:/[\d\$.]/,num:function(e){return e}})}}),Ext.define("App.view.menu.MenuPanel",{extend:"Ext.container.Container",alias:"widget.menupanel",initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){var e=[{flex:2,layout:"fit",xtype:"xtemplatetitulo"},{flex:6,xtype:"formpanel",layout:{type:"vbox",align:"stretch",pack:"start"},listeners:{scope:this,pedirtaxi:function(e){this.fireEvent("pedirtaxi",e)}}}];return e},setAddressText:function(e){this.items.items[1].items.items[0].setValue(e)}}),Ext.define("App.view.xtemplate.XtemplateTaxista",{extend:"Ext.DataView",alias:"widget.xtemplatetaxista",style:{fontFamily:"orbitron-light",paddingTop:"20px",paddingLeft:"20px",lineHeight:"25px"},initComponent:function(){this.tpl=this.tplTaxista(),this.callParent(arguments)},tplTaxista:function(){var e=new Ext.XTemplate('<tpl for="."><tpl if="nombre"><div class="media"><div style="text-align: center;"><h3 class="media-heading">Detalles del Taxista</h3></div><img height="140" style="border: 2px solid #99BBE8; width:100px; float: left;" class="media-object" src="images/man.png"><div style="padding-left: 115px;">Nombre:<br><font color="#999";> {nombre}</font><br>No. del Taxi:<br><font color="#999"> {unidad}</font><br>Placas:<br><font color="#999" > {placas}</font></div></div><tpl else><div class="media"><div style="text-align: center;"><h3 class="media-heading">Detalles del Taxista</h3><br><img id="detail-icon-img" src="http://cdn1.iconfinder.com/data/icons/customicondesignoffice2/128/FAQ.png" alt="answer, confusion, faq, question icon"></div></div></tpl></tpl>');return e}}),Ext.define("App.view.recarga.FormPanel",{extend:"Ext.container.Container",alias:"widget.containerrecarga",padding:"10 0 0 20",initComponent:function(){this.html=this.buildItems(),this.callParent(arguments)},buildItems:function(){return['<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_s-xclick"><table><tr><td><input type="hidden" name="on0" value="Trinus"></td><td><select name="os0"><option value="Recarga 1">Recarga 1 $5.00 MXN</option><option value="Recarga 2">Recarga 2 $30.00 MXN</option><option value="Recarga 3">Recarga 3 $50.00 MXN</option><option value="Recarga 4">Recarga 4 $200.00 MXN</option></select></td><td><input type="hidden" name="currency_code" value="MXN"><input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----"><input type="image" style="margin-top: 25px; margin-left: 10px;"  src="https://www.paypalobjects.com/es_XC/MX/i/btn/btn_buynowCC_LG.gif" border="0" name="submit" alt="PayPal, la forma más segura y rápida de pagar en línea."><img alt="" border="0" src="https://www.paypalobjects.com/es_XC/i/scr/pixel.gif" width="1" height="1"></td></table></form>']}}),Ext.define("App.view.admin.MenuAdminPanel",{extend:"Ext.panel.Panel",alias:"widget.menuadmin",frame:!0,opciones:null,initComponent:function(){var e=Ext.BLANK_IMAGE_URL,t='<ul id="task-views">';Ext.each(this.opciones,function(i){i.id=Ext.id(),t+='<li>		<img style="width:20px;" src="'+e+'" class="'+i.iconCls+'"/>'+'		<a id="'+i.id+'" class="'+i.cls+'" href="#">'+i.text+"</a>"+"</li>"},this),t+="</ul>",Ext.apply(this,{html:t}),this.callParent(arguments),this.on("afterrender",this.onafterRender)},onafterRender:function(){var e=this;this.body.on("click",function(t){Ext.each(e.opciones,function(i){t.getTarget("a."+i.cls)&&(e.titulo=i.text,e.panel=i.cls)},e),this.titulo&&this.fireEvent("opcion",this.titulo,this.panel)},this)}}),Ext.define("App.view.admin.taxistas.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelTaxi",layout:"border",esSitio:void 0,initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){return[{xtype:"gridpanelfilterT",region:"center",esSitio:this.esSitio,listeners:{scope:this,mask:function(){this.items.items[0].mask("Cargando....")},unmask:function(){this.items.items[0].unmask()}}}]}}),Ext.define("App.view.admin.clientes.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelCliente",layout:"border",esSitio:void 0,initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){return[this.getCentro()]},getCentro:function(){return{xtype:"gridpanelfilterC",region:"center",esSitio:this.esSitio,listeners:{scope:this,mask:function(){this.items.items[0].mask("Cargando....")},unmask:function(){this.items.items[0].unmask()}}}}}),Ext.define("App.view.admin.servicios.historial.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelHistorial",layout:"border",esSitio:void 0,initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){return[this.getCentro()]},getCentro:function(){return{xtype:"gridpanelfilterH",region:"center",esSitio:this.esSitio}}}),Ext.define("App.view.admin.servicios.asignar.Panel",{extend:"Ext.panel.Panel",alias:"widget.panelAsignar",layout:"border",esSitio:void 0,initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){return[{xtype:"gridpanelAsignar",region:"center",esSitio:this.esSitio}]}}),Ext.define("App.view.xtemplate.XtemplateTitulo",{extend:"Ext.DataView",alias:"widget.xtemplatetitulo",emptyText:"No hay taxistas disponibles",tpl:"",style:{backgroundColor:"#333",lineHeight:"90px",fontSize:"80pt",fontFamily:"orbitron-medium",textAlign:"center",paddingTop:"20px"},initComponent:function(){this.tpl=this.tplTaxista(),this.callParent(arguments)},tplTaxista:function(){return'<font color="FFC332">Trinus</font>'}}),Ext.define("App.view.menu.FormPanel",{extend:"Ext.form.FormPanel",alias:"widget.formpanel",bodyPadding:10,defaults:{labelAlign:"top",paddingTop:30,style:{fontFamily:"orbitron-medium"}},initComponent:function(){this.items=this.buildItems(),this.callParent(arguments)},buildItems:function(){var e=[{xtype:"textfield",fieldLabel:"Ubicaci&oacute;n",name:"txtOrigen",emptyText:"Ubicación"},{xtype:"textfield",fieldLabel:"Destino",id:"txtDestino",name:"txtDestino",emptyText:"No Obligatorio"},{xtype:"textarea",fieldLabel:"Observaciones",name:"txtObservaciones",emptyText:"No Obligatorio"},{xtype:"button",text:"<font size=14>Pedir Taxi</font>",flex:2,scope:this,ui:"warning",scale:"large",handler:function(){this.fireEvent("pedirtaxi",this.form.getValues())}}];return e},setAddressText:function(e){this.items.items[1].items.items[0].setValue(e)}}),Ext.define("App.view.admin.taxistas.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterT",esSitio:void 0,resumida:!1,viewConfig:{forceFit:!0,showPreview:!0,enableRowBody:!0,getRowClass:function(e,t,i){return"INACTIVO"==e.data.estatus?(i.body="<p>"+e.data.estatus+"didier</p>","redUnder"):void 0}},initComponent:function(){Ext.define("Taxi",{extend:"Ext.data.Model",fields:this.buildFields()}),this.store=this.buildStore(),this.columns=this.buildColumns(),this.plugins=this.buildPlugins(),this.dockedItems=this.buildDockedItems(),this.callParent(arguments),this.getSelectionModel().on("selectionchange",function(e,t){this.down("#delete").setDisabled(0===t.length)},this)},afterRender:function(){var e=this;e.callParent(arguments),e.textField=e.down("textfield[name=searchField]")},buildStore:function(){var e="?token="+localStorage.getItem("Logeado");this.esSitio&&(e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio);var t=new Ext.data.Store({model:"Taxi",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletTaxistas"+e,reader:{type:"json",root:"data"},writer:{type:"json"}}),autoLoad:!0,listeners:{scope:this,update:function(e,t){var i,a=this,t=t.data,n=new XMLHttpRequest,o="?nombre="+t.nombreCompleto+"&contrasena="+t.contrasena+"&direccion="+t.direccion+"&telCasa="+t.movil+"&movil="+t.movil+"&email="+t.email+"&"+"fechaNac=2013/02/11&imei="+t.imei+"&unidad="+t.unidad+"&placas="+t.placas;this.esSitio&&(o+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio),""==t.idTaxista?(a.fireEvent("mask"),i="http://isystems.com.mx:8181/Trinus/ServletTaxista/Create"+o+"&token="+localStorage.getItem("Logeado"),n&&(n.open("POST",i,!0),n.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var t=Ext.decode(e.target.responseText);"ok"===t.result?(a.store.load(),a.fireEvent("unmask")):Ext.MessageBox.alert("Información",t.result)}},n.send())):(a.fireEvent("mask"),i="http://isystems.com.mx:8181/Trinus/ServletTaxista/Update"+o+"&idTaxista="+t.idTaxista+"&token="+localStorage.getItem("Logeado"),n&&(n.open("POST",i,!0),n.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var t=Ext.decode(e.target.responseText);"ok"===t.result?(a.store.load(),a.fireEvent("unmask")):Ext.MessageBox.alert("Información",t.result)}},n.send()))}}});return t},buildColumns:function(){var e=[{text:"Nombre",flex:1,sortable:!0,dataIndex:"nombreCompleto",editor:{vtype:"nombre",allowBlank:!1}},{text:"Dirección",flex:1,sortable:!0,dataIndex:"direccion",editor:{vtype:"nombre",allowBlank:!1},hidden:this.resumida},{text:"Movil",flex:1,sortable:!0,dataIndex:"movil",editor:{vtype:"num",allowBlank:!1}},{text:"Email",flex:1,sortable:!0,dataIndex:"email",editor:{vtype:"email",allowBlank:!1},hidden:this.resumida},{text:"Imei",flex:1,sortable:!0,dataIndex:"imei",editor:{vtype:"num",allowBlank:!1},hidden:this.resumida},{text:"Unidad",flex:1,sortable:!0,dataIndex:"unidad",editor:{vtype:"alphanum",allowBlank:!1}},{text:"Placas",flex:1,sortable:!0,dataIndex:"placas",editor:{vtype:"alphanum",allowBlank:!1}},{text:"Contraseña",flex:1,sortable:!0,dataIndex:"contrasena",editor:{vtype:"alphanum",allowBlank:!1},hidden:this.resumida},{text:"Estatus",flex:1,sortable:!0,dataIndex:"estatus"}];return e},buildPlugins:function(){var e=Ext.create("Ext.grid.plugin.RowEditing");return[e]},buildDockedItems:function(){var e=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Agregar",ui:"success",iconCls:"icon-plus icon-white",hidden:e.esSitio,handler:function(){e.store.insert(0,new Taxi),e.plugins[0].startEdit(0,0)}},"-",{itemId:"delete",text:"Desactivar",ui:"danger",iconCls:"icon-remove icon-white",hidden:e.esSitio,disabled:!0,handler:function(){var t=e.getView().getSelectionModel().getSelection()[0];if(t){var i=t.data,a=new XMLHttpRequest,n="?idTaxista="+i.idTaxista+"&token="+localStorage.getItem("Logeado");this.esSitio&&(n+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio),e.fireEvent("mask"),""!=i.idTaxista&&a&&(a.open("POST","http://isystems.com.mx:8181/Trinus/ServletTaxista/Delete"+n,!0),a.onreadystatechange=function(t){if(4==t.target.readyState&&200==t.target.status){var i=Ext.decode(t.target.responseText);"ok"===i.result?(e.store.load(),e.fireEvent("unmask")):Ext.MessageBox.alert("Información",i.result)}},a.send()),e.store.remove(t),e.store.load(),e.fireEvent("unmask")}}},"-",{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",hidden:e.esSitio,handler:function(){e.fireEvent("mask"),e.store.load(),e.fireEvent("unmask")}},"->",{xtype:"textfield",fieldLabel:"Buscar",listeners:{scope:this,change:this.spotLight}}]}]},buildBbar:function(){var e,t,i,a,n,o,s,r,l,d=this;return t=d.buildTextField("nombreCompleto","nombre"),i=d.buildTextField("direccion","nombre"),a=d.buildTextField("movil","num"),n=d.buildTextField("email","email"),o=d.buildTextField("imei","num"),s=d.buildTextField("unidad","alphanum"),r=d.buildTextField("placas","alphanum"),l=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,iconCls:"icon-refresh icon-white",scope:this,handler:d.resetSearchs}),e=[t,i,a,n,o,s,r,l]},buildTextField:function(e,t){var i=this,a={xtype:"textfield",id:e+i.id,flex:1,vtype:t,emptyText:e,listeners:{scope:this,change:i.filterStore}};
return a},filterStore:function(){var e,t,i=this,a=["nombreCompleto","direccion","movil","email","imei","unidad","placas"];for(i.store.clearFilter(!1),e=0;a.length>e;e++)t=Ext.getCmp(a[e]+i.id).getValue(),Ext.isEmpty(t)||i.store.filter(a[e],t,!0,!1)},buildFields:function(){var e=[{name:"idTaxista",type:"string"},{name:"nombreCompleto",type:"string"},{name:"direccion",type:"string"},{name:"movil",type:"string"},{name:"email",type:"string"},{name:"imei",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"contrasena",type:"string"},{name:"estatus",type:"string"}];return e},resetSearchs:function(){var e,t=this,i=["nombreCompleto","direccion","movil","email","imei","unidad","placas"];for(t.store.clearFilter(!1),e=0;i.length>e;e++)Ext.getCmp(i[e]+t.id).reset()},spotLight:function(e,t){var i=this;i.store.clearFilter(!0),i.store.filterBy(function(e){return-1!=e.get("nombreCompleto").search(t)||-1!=e.get("movil").search(t)||-1!=e.get("email").search(t)||-1!=e.get("contrasena").search(t)||-1!=e.get("direccion").search(t)||-1!=e.get("unidad").search(t)||-1!=e.get("imei").search(t)||-1!=e.get("placas").search(t)?!0:void 0},this)}}),Ext.define("App.view.admin.clientes.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterC",esSitio:void 0,viewConfig:{forceFit:!0,showPreview:!0,enableRowBody:!0,getRowClass:function(e,t,i){return"INACTIVO"==e.data.estatus?(i.body="<p>"+e.data.estatus+"didier</p>","redUnder"):void 0}},initComponent:function(){Ext.define("Cliente",{extend:"Ext.data.Model",fields:this.buildFields()}),this.store=this.buildStore(),this.columns=this.buildColumns(),this.plugins=this.buildPlugins(),this.dockedItems=this.buildDockedItems(),this.callParent(arguments),this.getSelectionModel().on("selectionchange",function(e,t){this.down("#delete").setDisabled(0===t.length)},this)},afterRender:function(){var e=this;e.callParent(arguments),e.textField=e.down("textfield[name=searchField]")},buildStore:function(){var e="?token="+localStorage.getItem("Logeado");this.esSitio&&(e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitito);var t=new Ext.data.Store({model:"Cliente",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletClientes"+e,reader:{type:"json",root:"data"},writer:{type:"json"}}),autoLoad:!0,listeners:{scope:this,update:function(e,t){var i,a=this,t=t.data,n=new XMLHttpRequest,o="nombre="+t.nombreCompleto+"&contrasena="+t.contrasena+"&movil="+t.movil+"&email="+t.email;this.esSitio&&(o+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio),""==t.idCliente?(a.fireEvent("mask"),i="http://isystems.com.mx:8181/Trinus/ServletCliente/Create?"+o+"&token="+localStorage.getItem("Logeado"),n&&(n.open("POST",i,!0),n.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var t=Ext.decode(e.target.responseText);"ok"===t.result?(a.store.load(),a.fireEvent("unmask")):(Ext.MessageBox.alert("Información",t.result),a.store.load(),a.fireEvent("unmask"))}},n.send())):(a.fireEvent("mask"),i="http://isystems.com.mx:8181/Trinus/ServletCliente/Update?"+o+"&idCliente="+t.idCliente+"&token="+localStorage.getItem("Logeado"),n&&(n.open("POST",i,!0),n.onreadystatechange=function(e){if(4==e.target.readyState&&200==e.target.status){var t=Ext.decode(e.target.responseText);"ok"===t.result?(a.store.load(),a.fireEvent("unmask")):Ext.MessageBox.alert("Información",t.result)}},n.send()))}}});return t},buildColumns:function(){var e=[{text:"Nombre",flex:1,sortable:!0,dataIndex:"nombreCompleto",editor:{vtype:"nombre",allowBlank:!1}},{text:"Movil",flex:1,sortable:!0,dataIndex:"movil",editor:{vtype:"num",allowBlank:!1}},{text:"Email",flex:1,sortable:!0,dataIndex:"email",editor:{vtype:"email",allowBlank:!1}},{text:"Contraseña",flex:1,sortable:!0,dataIndex:"contrasena",editor:{vtype:"alphanum",allowBlank:!1}},{text:"Estatus",flex:1,sortable:!0,dataIndex:"estatus"}];return e},buildPlugins:function(){var e=Ext.create("Ext.grid.plugin.RowEditing");return[e]},buildDockedItems:function(){var e=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Agregar",ui:"success",handler:function(){e.store.insert(0,new Cliente),e.plugins[0].startEdit(0,0)}},"-",{itemId:"delete",text:"Desactivar",ui:"danger",disabled:!0,handler:function(){var t=e.getView().getSelectionModel().getSelection()[0];if(t){var i=t.data,a=new XMLHttpRequest,n="?idCliente="+i.idCliente+"&token="+localStorage.getItem("Logeado");this.esSitio&&(n+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio),e.fireEvent("mask"),""!=i.idCliente&&a&&(a.open("POST","http://isystems.com.mx:8181/Trinus/ServletCliente/Delete"+n,!0),a.onreadystatechange=function(t){if(4==t.target.readyState&&200==t.target.status){var i=Ext.decode(t.target.responseText);"ok"===i.result?(e.store.load(),e.fireEvent("unmask")):Ext.MessageBox.alert("Información",i.result)}},a.send()),e.store.remove(t),e.store.load(),e.fireEvent("unmask")}}},"-",{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",handler:function(){e.fireEvent("mask"),e.store.load(),e.fireEvent("unmask")}},"->",{xtype:"textfield",fieldLabel:"Buscar",listeners:{scope:this,change:this.spotLight}}]}]},buildBbar:function(){var e,t,i,a,n,o=this;return t=o.buildTextField("nombreCompleto","nombre"),i=o.buildTextField("movil","num"),a=o.buildTextField("email","email"),n=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,scope:this,handler:o.resetSearchs}),e=[t,i,a,n]},buildTextField:function(e,t){var i=this,a={xtype:"textfield",id:e+i.id,flex:1,vtype:t,emptyText:e,listeners:{scope:this,change:i.filterStore}};return a},filterStore:function(){var e,t,i=this,a=["nombreCompleto","movil","email"];for(i.store.clearFilter(!1),e=0;a.length>e;e++)t=Ext.getCmp(a[e]+i.id).getValue(),Ext.isEmpty(t)||i.store.filter(a[e],t,!0,!1)},buildFields:function(){var e=[{name:"idCliente",type:"string"},{name:"nombreCompleto",type:"string"},{name:"movil",type:"string"},{name:"email",type:"string"},{name:"contrasena",type:"string"},{name:"estatus",type:"string"}];return e},resetSearchs:function(){var e,t=this,i=["nombreCompleto","movil","email"];for(t.store.clearFilter(!1),e=0;i.length>e;e++)Ext.getCmp(i[e]+t.id).reset()},spotLight:function(e,t){var i=this;i.store.clearFilter(!0),i.store.filterBy(function(e){return-1!=e.get("nombreCompleto").search(t)||-1!=e.get("movil").search(t)||-1!=e.get("email").search(t)||-1!=e.get("contrasena").search(t)||-1!=e.get("estatus").search(t)?!0:void 0},this)}}),Ext.define("App.view.admin.servicios.historial.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelfilterH",esSitio:void 0,initComponent:function(){Ext.define("Historial",{extend:"Ext.data.Model",fields:this.buildFields()}),this.store=this.buildStore(),this.columns=this.buildColumns(),this.dockedItems=this.buildDockedItems(),this.bbar=this.buildBbar(),this.callParent(arguments)},buildColumns:function(){var e=[{text:"Nombre Cliente",flex:1,sortable:!0,dataIndex:"nombreCliente"},{text:"Nombre Taxista",flex:1,sortable:!0,dataIndex:"nombreTaxista"},{text:"Dirección",flex:1,sortable:!0,dataIndex:"direccion"},{text:"Unidad",flex:1,sortable:!0,dataIndex:"unidad"},{text:"Placas",flex:1,sortable:!0,dataIndex:"placas"},{text:"Fecha",flex:1,sortable:!0,dataIndex:"fechaHora"},{text:"Estatus",flex:1,sortable:!0,dataIndex:"estatus"},{text:"Observaciones",flex:1,sortable:!0,dataIndex:"observaciones"}];return e},buildStore:function(){var e="?token="+localStorage.getItem("Logeado");this.esSitio&&(e+="&idSitio="+Ext.decode(localStorage.getItem("Usuario")).idSitio);var t=new Ext.data.Store({model:"Historial",proxy:new Ext.data.ScriptTagProxy({url:"http://isystems.com.mx:8181/Trinus/ServletServicios"+e,reader:{type:"json",root:"data"}}),autoLoad:!0});return t},buildFields:function(){var e=[{name:"nombreCliente",type:"string"},{name:"nombreTaxista",type:"string"},{name:"direccion",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"fechaHora",type:"string"},{name:"estatus",type:"string"},{name:"observaciones",type:"string"}];return e},buildDockedItems:function(){var e=this;return[{text:"Actualizar",ui:"inverse",iconCls:"icon-refresh icon-white",handler:function(){e.fireEvent("mask"),e.store.load(),e.fireEvent("unmask")}}]},buildBbar:function(){var e,t,i,a,n,o,s=this;return t=s.buildTextField("nombreTaxista","nombre"),i=s.buildTextField("nombreCliente","nombre"),a=s.buildDateField("fechaHora"),n=s.buildCombo("estatus","estatus"),o=Ext.create("Ext.Button",{text:"Limpiar",ui:"info",flex:1,iconCls:"icon-refresh icon-white",scope:this,handler:s.resetSearchs}),e=[t,i,a,n,o]},buildTextField:function(e,t){var i=this,a={xtype:"textfield",id:e+i.id,flex:1,vtype:t,emptyText:e,listeners:{scope:this,change:i.filterStore}};return a},filterStore:function(){var e,t,i=this,a=["nombreTaxista","nombreCliente","fechaHora","estatus"];for(i.store.clearFilter(!1),e=0;a.length>e;e++)t=Ext.getCmp(a[e]+i.id).getValue(),Ext.isEmpty(t)||i.store.filter(a[e],t,!0,!1)},buildDateField:function(e){var t=this,i={xtype:"datefield",id:e+t.id,flex:1,emptyText:e,listeners:{scope:this,change:t.filterStore}};return i},buildCombo:function(e,t){var i,a=this;return i=Ext.create("Ext.form.ComboBox",{id:t+this.id,store:a.buildStore().collect(t),emptyText:e,displayField:t,valueField:t,queryMode:"local",flex:1,listeners:{scope:this,change:function(){a.filterStore()}}})},resetSearchs:function(){var e,t=this,i=["nombreTaxista","nombreCliente","fechaHora","estatus"];for(t.store.clearFilter(!1),e=0;i.length>e;e++)Ext.getCmp(i[e]+t.id).reset()}}),Ext.define("App.view.admin.servicios.asignar.GridPanel",{extend:"Ext.grid.Panel",alias:"widget.gridpanelAsignar",initComponent:function(){Ext.define("Servicio",{extend:"Ext.data.Model",fields:this.buildFields()}),this.store=this.buildStore(),this.columns=this.buildColumns(),this.dockedItems=this.buildDockedItems(),this.callParent(arguments)},buildColumns:function(){var e=[{text:"Nombre Cliente",flex:1,sortable:!0,dataIndex:"nombreCliente"},{text:"Nombre Taxista",flex:1,sortable:!0,dataIndex:"nombreTaxista",hidden:this.esSitio},{text:"Dirección",flex:1,sortable:!0,dataIndex:"direccion"},{text:"Unidad",flex:1,sortable:!0,dataIndex:"unidad",hidden:this.esSitio},{text:"Placas",flex:1,sortable:!0,dataIndex:"placas",hidden:this.esSitio},{text:"Fecha",flex:1,sortable:!0,dataIndex:"fechaHora"},{text:"Estatus",flex:1,sortable:!0,dataIndex:"estatus"},{text:"Observaciones",flex:1,sortable:!0,dataIndex:"observaciones"}];return e},buildDockedItems:function(){var e=this;return[{xtype:"toolbar",dock:"top",items:[{text:"Asignar Taxi",ui:"success",iconCls:"icon-add icon-white",handler:e.asignarTaxi.bind(e)}]}]},buildFields:function(){var e=[{name:"idServicio",type:"int"},{name:"idTaxista",type:"int"},{name:"nombreCliente",type:"string"},{name:"nombreTaxista",type:"string"},{name:"direccion",type:"string"},{name:"unidad",type:"string"},{name:"placas",type:"string"},{name:"fechaHora",type:"string"},{name:"estatus",type:"string"},{name:"observaciones",type:"string"}];return e},buildStore:function(){var e=new Ext.data.Store({model:"Servicio",storeId:"storeAsignar",data:[]});return e},asignarTaxi:function(){var e=this,t=this.getSelectionModel().getSelection();if(t[0]){var i=Ext.create("Ext.window.Window",{title:"Buscar Taxista",id:"windowBuscarTaxista"+this.id,modal:!0,width:600,height:450,items:[{xtype:"gridpanelfilterT",resumida:!0,esSitio:e.esSitio}],buttons:[{text:"Aceptar",handler:this.onSeleccionarTaxi.bind(e)},{text:"Cancelar",scope:this,handler:function(){i.close()}}]});i.show()}else Ext.MessageBox.alert("Información","Debes seleccionar un Servicio.")},onSeleccionarTaxi:function(){var e=this,t=Ext.getCmp("windowBuscarTaxista"+e.id),i=t.down("gridpanelfilterT"),a=e.getSelectionModel().getSelection(),n=i.getSelectionModel().getSelection();if(n[0]){var o="?token="+localStorage.getItem("Logeado")+"&idServicio="+a[0].data.idServicio+"&idTaxista="+n[0].data.idTaxista,s=new XMLHttpRequest,r="http://isystems.com.mx:8181/Trinus/ServletOperadoraSitio"+o;s&&(s.open("POST",r,!0),s.onreadystatechange=function(i){if(4==i.target.readyState&&200==i.target.status){var n=Ext.decode(i.target.responseText);console.log("respuesta ServletOperadoraSitio"+n),"ok"==n.result&&(e.getStore().remove(a[0]),t.close(),Ext.MessageBox.alert("Información","!Enhorabuena el servicio ha sido asignado¡"))}},s.send())}else Ext.MessageBox.alert("Información","Selecciona un taxista para continuar.")}}),Ext.apply(Ext.form.field.VTypes,{nombreMask:/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/,nombreText:"Nombre no v&aacute;lido",nombre:function(e){var t=/^[(a-zA-Z0-9 \u00e1\u00c1\u00e9\u00c9\u00ed\u00cd\u00f3\u00d3\u00fa\u00da\u00f1\u00d1.\,\/\-)]+$/;return t.test(e)},numMask:/[\d\$.]/,num:function(e){return e}});
//@ sourceMappingURL=build/source-map.js